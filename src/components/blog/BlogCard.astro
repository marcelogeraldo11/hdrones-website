---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { formatDate } from '@/lib/utils';

interface Props {
  title: string;
  description: string;
  href: string;
  publishedAt: Date;
  tags?: string[];
  featured?: boolean;
  author?: string;
  image?: ImageMetadata;
}

const {
  title,
  description,
  href,
  publishedAt,
  tags = [],
  featured = false,
  author,
  image,
} = Astro.props;

// Estimate reading time (rough estimate based on average words)
const wordsPerMinute = 200;
const estimatedWords = description.split(' ').length * 10; // Rough estimate
const readingTime = Math.max(1, Math.ceil(estimatedWords / wordsPerMinute));
---

<article
  class:list={[
    'group relative flex flex-col rounded-2xl border bg-background overflow-hidden transition-all duration-300 ease-out',
    featured
      ? 'border-brand-500/30 ring-1 ring-brand-500/20 shadow-xl'
      : 'border-border/60 hover:shadow-2xl hover:shadow-brand-500/10 hover:border-brand-500/20',
  ]}
>
  {featured && (
    <div class="absolute top-4 left-4 z-10">
      <span class="inline-flex items-center gap-1 rounded-full bg-brand-500 px-3 py-1 text-[10px] uppercase tracking-wider font-bold text-white shadow-lg">
        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
        Destacado
      </span>
    </div>
  )}

  <a href={href} class="flex flex-col h-full">
    {image && (
      <div class="relative aspect-video overflow-hidden">
        <Image
          src={image}
          alt={title}
          widths={[320, 640, 960]}
          sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 400px"
          class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
      </div>
    )}

    <div class="flex flex-col flex-1 p-5 md:p-6">
      <div class="flex items-center gap-2 mb-3 text-[11px] font-bold uppercase tracking-widest text-brand-600">
         <time datetime={publishedAt.toISOString()}>
            {formatDate(publishedAt)}
         </time>
         <span class="w-1 h-1 rounded-full bg-border"></span>
         <span>{readingTime} min lectura</span>
      </div>

      <h2 class="font-display text-xl md:text-2xl font-bold text-foreground leading-tight transition-colors group-hover:text-brand-600 mb-3 line-clamp-2">
        {title}
      </h2>

      <p class="text-foreground-muted text-sm md:text-base line-clamp-2 mb-6 flex-1">
        {description}
      </p>

      <div class="flex items-center justify-between pt-4 border-t border-border/50 mt-auto">
        {author && (
          <div class="flex items-center gap-2">
            <div class="h-8 w-8 rounded-full bg-brand-500 flex items-center justify-center text-[10px] font-black text-white shadow-sm ring-2 ring-background">
              {author.charAt(0).toUpperCase()}
            </div>
            <span class="text-xs font-bold text-foreground">{author}</span>
          </div>
        )}
        
        <div class="text-brand-600 group-hover:translate-x-1 transition-transform duration-200">
           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        </div>
      </div>
    </div>
  </a>
</article>
